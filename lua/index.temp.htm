#{include: 'doctype.seg.htm' }
<head>
#{include: 'head-common.seg.htm' }
<title>遥远的街市</title>
<script type="text/javascript">
if (window.top != window) {
	alert('检测到疑似被ISP劫持强插广告，请刷新重试。\n本站地址：#{= siteurl }\n即将重定向');
	// window.top.location.href = '#{= siteurl }/?r=' + Math.random().toString(36).substring(2);
	// location.href = "about:blank";
}
</script>
</head>

<body>
<div id="page">

#{include: 'header.seg.htm' }
#{ local selectedIndex = 0 }#{include: 'nav.seg.htm' }#{ selectedIndex = null }
<div id="content">
#{include: 'searchbar.seg.htm' }
<p style="font-size: 14px; margin-bottom: 2em">　　这里是 henix 的技术博客，我平时遇到的各种技术问题和想法会记录在这里。 :)</p>
#{ for _, catename in ipairs(categories) do }
#{ local cate = categories[catename] }
<div class="box" data-class="CateItem">
<h5 class="cate-title"><a name="#{= catename }" href="javascript:;" data-name="toggleA">#{= cate.showname }</a></h5>
<ul class="box-body post-list">#{ for _, i in ipairs(cate) do }
#{ local post = blogposts[i] }<li data-name="postItems[]" data-class="PostItem">
<div class="post-line clearfix" data-name="postLine">
	<span class="post-time">#{= os.date('%Y-%m-%d', post.publish_time) }</span>
	<span class="post-title"><a href="#{= getPostURL(post) }">#{= post.title }</a></span>
	<span class="post-stat">#{= post.comnum } 条评论 | #{= post.visits } 次浏览</span>
</div>
<div class="blogpost" data-name="postDetail">
	<div class="postcontent">#{= digestHTML(slt2.render(slt2.loadstring(post.content)), 200) }... <a href="#{= getPostURL(post) }">阅读全文</a></div>
	<div class="post-tags">
		#{ for j, tagname in ipairs(post.tags) do }
		#{ if j ~= 1 then },#{ end }
		#{ local tag = tags[tagname] }
		<a href="#{= getTagURL(tag) }" title="#{= #tag.posti } 篇文章" class="tooltip">#{= tagname }<span>(#{= tag.desc })</span></a>
		#{ end }
	</div>
</div>
</li>#{ end }
</ul></div>#{ end }

#{include: 'popular.seg.htm' }
#{include: 'tags.seg.htm' }
</div><!-- end of content -->

#{include: 'footer.seg.htm' }
</div><!-- end of page -->

#inline Flower.csser
#inline Flower.eventer.addEventListener
#inline Flower.ie.version
#inline Flower.ie.hoverClass
#inline FlowerUI.compiler
<script type="text/javascript">
function PostItem(elem) {
	this.postLine = null;
	this.postDetail = null;
	this.expanded = null;
}
PostItem.prototype.expand = function() {
	Flower.csser.addClass(this.postLine.parentNode, 'active');
	this.postDetail.style.display = 'block';
	this.expanded = true;
};
PostItem.prototype.collapse = function() {
	this.postDetail.style.display = 'none';
	Flower.csser.removeClass(this.postLine.parentNode, 'active');
	this.expanded = false;
};
PostItem.prototype.toggle = function() {
	if (this.expanded) {
		this.collapse();
	} else {
		this.expand();
	}
};
PostItem.prototype.init = function() {
	var this1 = this;
	this.postDetail.style.display = 'none';
	this.expanded = false;
	Flower.eventer.addEventListener(this.postLine, 'click', function() {
		this1.toggle();
	});
	var ie = Flower.ie.version();
	if (ie && ie < 7) {
		// ie7 以下不支持任意元素的 :hover
		Flower.ie.hoverClass(this.postLine, 'post-line-hover');
	}
};

function CateItem(elem) {
	this.postItems = [];
	this.toggleA = null;
	this.expanded = null;
}
CateItem.prototype.expandAll = function() {
	for (var i = 0; i < this.postItems.length; i++) {
		this.postItems[i].expand();
	}
	this.expanded = true;
	this.toggleA.title = '全部折叠';
};
CateItem.prototype.collapseAll = function() {
	for (var i = 0; i < this.postItems.length; i++) {
		this.postItems[i].collapse();
	}
	this.expanded = false;
	this.toggleA.title = '全部展开';
};
CateItem.prototype.toggleAll = function() {
	if (this.expanded) {
		this.collapseAll();
	} else {
		this.expandAll();
	}
};
CateItem.prototype.init = function() {
	this.expanded = false;
	this.toggleA.title = '全部展开';

	var this1 = this;
	Flower.eventer.addEventListener(this.toggleA, 'click', function() {
		this1.toggleAll();
	});
};

FlowerUI.compileAll();
</script>

#{include: 'ga.seg.htm' }
</body>
</html>
